<template>
  <div class="container">
    <MqResponsive target="sm-">
      <section>
        <div class="header">
          <h1>{{ $t("balance.h1") }}</h1>
          <base-button style="background-color: #3d5cb7; padding: 5px">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.7514 7.04997C17.5114 7.00997 17.2614 6.99998 17.0014 6.99998H7.00141C6.72141 6.99998 6.45141 7.01998 6.19141 7.05998C6.33141 6.77998 6.53141 6.52001 6.77141 6.28001L10.0214 3.02C11.3914 1.66 13.6114 1.66 14.9814 3.02L16.7314 4.78996C17.3714 5.41996 17.7114 6.21997 17.7514 7.04997Z"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M9 19C9 19.75 8.79 20.46 8.42 21.06C7.73 22.22 6.46 23 5 23C3.54 23 2.27 22.22 1.58 21.06C1.21 20.46 1 19.75 1 19C1 16.79 2.79 15 5 15C7.21 15 9 16.79 9 19Z"
                stroke="white"
                stroke-width="1.5"
                stroke-miterlimit="10"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M6.49172 18.9795H3.51172"
                stroke="white"
                stroke-width="1.5"
                stroke-miterlimit="10"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M5 17.5195V20.5095"
                stroke="white"
                stroke-width="1.5"
                stroke-miterlimit="10"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M22 12V17C22 20 20 22 17 22H7.63C7.94 21.74 8.21 21.42 8.42 21.06C8.79 20.46 9 19.75 9 19C9 16.79 7.21 15 5 15C3.8 15 2.73 15.53 2 16.36V12C2 9.28 3.64 7.38 6.19 7.06C6.45 7.02 6.72 7 7 7H17C17.26 7 17.51 7.00999 17.75 7.04999C20.33 7.34999 22 9.26 22 12Z"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M22 12.5H19C17.9 12.5 17 13.4 17 14.5C17 15.6 17.9 16.5 19 16.5H22"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </base-button>
        </div>
      </section>
    </MqResponsive>
    <MqResponsive target="md-xl">
      <section>
        <div class="header">
          <h1>{{ $t("balance.h1") }}</h1>
          <base-button class="btn">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.7514 7.04997C17.5114 7.00997 17.2614 6.99998 17.0014 6.99998H7.00141C6.72141 6.99998 6.45141 7.01998 6.19141 7.05998C6.33141 6.77998 6.53141 6.52001 6.77141 6.28001L10.0214 3.02C11.3914 1.66 13.6114 1.66 14.9814 3.02L16.7314 4.78996C17.3714 5.41996 17.7114 6.21997 17.7514 7.04997Z"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M9 19C9 19.75 8.79 20.46 8.42 21.06C7.73 22.22 6.46 23 5 23C3.54 23 2.27 22.22 1.58 21.06C1.21 20.46 1 19.75 1 19C1 16.79 2.79 15 5 15C7.21 15 9 16.79 9 19Z"
                stroke="white"
                stroke-width="1.5"
                stroke-miterlimit="10"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M6.49172 18.9795H3.51172"
                stroke="white"
                stroke-width="1.5"
                stroke-miterlimit="10"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M5 17.5195V20.5095"
                stroke="white"
                stroke-width="1.5"
                stroke-miterlimit="10"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M22 12V17C22 20 20 22 17 22H7.63C7.94 21.74 8.21 21.42 8.42 21.06C8.79 20.46 9 19.75 9 19C9 16.79 7.21 15 5 15C3.8 15 2.73 15.53 2 16.36V12C2 9.28 3.64 7.38 6.19 7.06C6.45 7.02 6.72 7 7 7H17C17.26 7 17.51 7.00999 17.75 7.04999C20.33 7.34999 22 9.26 22 12Z"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M22 12.5H19C17.9 12.5 17 13.4 17 14.5C17 15.6 17.9 16.5 19 16.5H22"
                stroke="white"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            {{ $t("balance.btn") }}
          </base-button>
        </div>
      </section>
    </MqResponsive>

    <section>
      <base-card class="filter">
        <div class="filter__search">
          <form>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M17.3952 15.9761C19.852 12.8209 19.63 8.25612 16.7295 5.3556C13.5887 2.2148 8.49642 2.2148 5.35561 5.3556C2.2148 8.49642 2.2148 13.5887 5.35561 16.7295C8.25614 19.63 12.821 19.8519 15.9762 17.3952C15.9897 17.4106 16.0039 17.4257 16.0186 17.4403L20.2838 21.7055C20.6764 22.0982 21.313 22.0982 21.7056 21.7055C22.0981 21.3129 22.0981 20.6764 21.7056 20.2838L17.4404 16.0186C17.4256 16.0039 17.4105 15.9898 17.3952 15.9761ZM15.2426 6.75737C17.5858 9.10051 17.5858 12.8995 15.2426 15.2427C12.8995 17.5858 9.1005 17.5858 6.75736 15.2427C4.41421 12.8995 4.41421 9.10051 6.75736 6.75737C9.1005 4.41421 12.8995 4.41421 15.2426 6.75737Z"
                fill="#8f92a1"
              />
            </svg>
            <input v-model="query" type="search" placeholder="Search" />
          </form>
          <div class="filter_number">
            {{ $t("balance.filter") }}
            <select name="filter" id="filter" @change="limitChanged($event)">
              <optgroup>
                <option
                  v-for="item in item_counts"
                  :key="item"
                  :value="item"
                  :selected="item === limit"
                >
                  {{ item }}
                </option>
              </optgroup>
            </select>
          </div>
        </div>

        <div class="filter__filter">
          <table>
            <tr>
              <th>{{ $t("balance.table.th-1") }}</th>
              <th>{{ $t("balance.table.th-2") }}</th>
              <th>{{ $t("balance.table.th-4") }}</th>
            </tr>
            <tr v-for="history in history_list" :key="history.id">
              <td>{{ history.created_at }}</td>
              <td>{{ history.action }}</td>
              <td>{{ history.sum }} TMT</td>
            </tr>
          </table>
        </div>
        <the-pagination
          :page-count="page_count"
          :click-handler="pageChanged"
          :prev-text="'<<'"
          :next-text="'>>'"
        >
          ></the-pagination
        >
      </base-card>
    </section>
  </div>
</template>

<script>
import { MqResponsive } from "vue3-mq";
import { mapActions, mapGetters } from "vuex";
import ThePagination from "../layout/ThePagination.vue";

export default {
  components: {
    ThePagination,
    MqResponsive,
  },
  data() {
    return {
      isLoading: true,
      limit: 10,
      query: null,
      item_counts: [10, 20, 30, 40, 50],
    };
  },
  watch: {
    limit() {
      this.resetList();
    },
    query() {
      this.resetList();
    },
    page() {
      this.loadHistoryList();
    },
  },
  methods: {
    ...mapActions({
      loadHistory: "balance/loadBalanceHistory",
    }),
    pageChanged(page) {
      this.page = page;
      this.loadHistoryList();
    },
    limitChanged(event) {
      this.limit = event.target.value;
    },
    resetList() {
      this.page = 1;
      this.loadHistoryList();
    },
    async loadHistoryList() {
      this.isLoading = true;
      try {
        await this.loadHistory({
          page: this.page,
          limit: this.limit,
          query: this.query,
        });
      } catch (err) {
        console.log(err);
        this.$store.commit("set_error", "Cannot load data please try again");
        this.$router.push({ path: "/" });
      }
    },
  },
  computed: {
    ...mapGetters({
      history_list: "balance/get_history_list",
      total: "balance/get_total_count",
    }),
    page_count() {
      return Math.ceil((this.total || []) / this.limit);
    },
  },
  mounted() {
    this.loadHistoryList();
  },
};
</script>

<style scoped>
.container {
  height: 100vh;
  margin: 10px 0 0 15px;
  border-radius: 10px;

  background-color: rgba(141, 143, 161, 0.1);
  font-weight: "Plus Jakarta Sans";
  padding: 10px 30px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #ddd;
}

.btn {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

.filter {
  background-color: white;
}

.filter__search {
  display: flex;
  justify-content: space-between;
}

.filter_number {
  display: flex;
}
#filter {
  flex: 1;
  text-align: right;
}
.filter__search form {
  width: 500px;
  display: flex;
  align-items: center;
  padding: 10px 5px;
  background-color: #f3f4f5;
  border-radius: 10px;
}

.filter__search input {
  border: none;
  background-color: transparent;
  width: 100%;
  outline: none;
}

.filter__search input::placeholder {
  color: #8f92a1;
  font-weight: 500;
  font-size: 16px;
  line-height: 32px;
}

.filter__search div {
  padding: 10px 5px;
  border-radius: 10px;
  background-color: #f3f4f5;
  color: #8f92a1;
  font-weight: 500;
}

.filter__search select {
  border: none;
  background-color: transparent;
  font-size: 16px;
}

.filter__filter {
  overflow-y: scroll;
}
table {
  margin-top: 20px;
  border-collapse: collapse;
  width: 100%;
}

th,
td {
  border-bottom: 1px solid #f3f4f5;
  text-align: left;
  padding: 10px;
}

tr:first-child {
  background-color: #f3f4f5;
}

@media (width<=780px) {
  .filter__search form {
    width: 400px;
  }
  @media (width<=680px) {
    .filter__search form {
      width: 100%;
    }
    .filter__search {
      display: block;
    }
    .filter_number {
      margin-top: 10px;
      width: 100%;
    }

    table th,
    table td {
      font-size: 14px;
    }
    @media (width<=470px) {
      .header {
        gap: 10px;
      }
      .header h1 {
        font-size: 22px;
      }

      .btn {
        padding: 10px;
      }
      .container {
        margin: 0;
        padding: 5px;
      }
      @media (width<=420px) {
        .header h1 {
          font-size: 20px;
        }
        .btn {
          padding: 7px;
        }
      }
    }
  }
}
</style>
